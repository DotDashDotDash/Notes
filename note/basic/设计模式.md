# 设计模式

## 单例模式

* 懒汉模式，非线程安全

```java
public class Singleton{
    private static Singleton singleton;
    private Singleton(){}

    public static Singleton getInstance(){
        if(singleton == null){
            singleton = new Singleton();
        }
        return singleton;
    }
}
````

* 懒汉模式，线程安全

```java
public class Singleton{
    private static Singleton singleton;
    private Singleton(){}

    public static synchronized Singleton getInstance(){
        if(singleton == null){
            singleton = new Singleton();
        }
        return singleton;
    }
}
```

* 饿汉模式，线程安全

```java
public class Singleton{
    private static Singleton singleton = new Singleton();
    private Singleton(){}

    public static Singleton getInstance(){
        return singleton;
    }
}
```

* 双重验证锁，懒汉模式，线程安全

```java
public class Singleton{
    private volatile static Singleton singleton;
    private Singleton(){}

    public static Singleton getInstance(){
        if(singleton == null){
            synchronized(Singleton.class){
                if(singleton == null){
                    singleton = new Singleton();
                }
            }
        }
        return singleton;
    }
}
```

* 备忘录模式，懒汉模式，线程安全

```java
public class Singleton{
    static class Handler{
        public static final Singleton singleton = new Singleton();
    }

    public static final Singleton getInstance(){
        return Handler.singleton;
    }
}
```

## 建造者模式

```java
public class BuilderPrinciple {

    interface Packing{
        String packing();
    }

    interface Item{
        String name();
        String packing();
        float price();
    }

    class Wrapper implements Packing {
        @Override
        public String packing(){
            return "Wrapper";
        }
    }

    class Bottle implements Packing{
        @Override
        public String packing(){
            return "Bottle";
        }
    }

    abstract class Suger implements Item{
        @Override
        public String packing(){
            return new Wrapper().packing();
        }

        @Override
        public abstract float price();
    }

    abstract class Cake implements Item{
        @Override
        public String packing(){
            return new Bottle().packing();
        }

        @Override
        public abstract float price();
    }

    class CNSuger extends Suger{
        @Override
        public String name(){
            return "CNSuger";
        }

        @Override
        public float price(){
            return 50f;
        }
    }

    class CNCake extends Cake{
        @Override
        public String name(){
            return "CNCake";
        }

        @Override
        public float price(){
            return 70f;
        }
    }

    class Meal{
        List<Item> meal = new ArrayList<>();

        public void addItem(Item item){
            meal.add(item);
        }

        public float getPrice(){
            float result = 0f;
            for(Item m : meal){
                result += m.price();
            }
            return result;
        }

        public void showItems(){
            System.out.println("total price: " + getPrice());
            for(Item m : meal){
                System.out.printf("name: %s, packing: %s, price: %f\n", m.name(), m.packing(), m.price());
            }
        }
    }

    public static void main(String[] args){
        Meal meal = new BuilderPrinciple().new Meal();
        meal.addItem(new BuilderPrinciple().new CNCake());
        meal.addItem(new BuilderPrinciple().new CNSuger());

        meal.showItems();
    }

}
```

## 原型模式

用于解决创建对象的大开销

```java
public class PrototypePrinciple {

    abstract class Shape implements Cloneable{
        String name;

        public void setName(String name){
            this.name = name;
        }

        public String getName(){
            return this.name;
        }

        @Override
        public Object clone(){
            Object obj = null;
            try {
                obj = super.clone();
            } catch (CloneNotSupportedException e) {
                e.printStackTrace();
            }
            return obj;
        }
    }

    class Circle extends Shape{}
    class Rectangular extends Shape{}

    class ShapeCache{
        private HashMap<String, Shape> map = new HashMap<>();

        public void loadCache(){
            Circle circle = new Circle();
            circle.setName("circle");
            map.put("circle", circle);

            Rectangular rectangular = new Rectangular();
            rectangular.setName("rectangular");
            map.put("rectangular", rectangular);
        }

        public HashMap<String, Shape> getCache(){
            return this.map;
        }

        public void show(){
            Circle circle = (Circle) map.get("circle");
            Rectangular rectangular = (Rectangular) map.get("rectangular");

            System.out.println("circle: " + circle.getName());
            System.out.println("rectangular: " + rectangular.getName());
        }
    }

    public static void main(String[] args){
        ShapeCache cache = new PrototypePrinciple().new ShapeCache();
        cache.loadCache();

        cache.show();
    }
}

```

## 适配器模式

高级和低级类之间的耦合

```java
public class AdapterPattern {

    interface Player{
        void play(String audioType);
    }

    interface AdvancedPlayer{
        void playVc();
        void playMedia();
    }

    class VcPlayer implements AdvancedPlayer{
        @Override
        public void playVc(){
            System.out.println("this is Vc player");
        }

        @Override
        public void playMedia(){

        }
    }

    class MediaPlayer implements AdvancedPlayer{
        @Override
        public void playVc(){

        }

        @Override
        public void playMedia(){
            System.out.println("this is media player");
        }
    }

    class PlayerAdapter implements Player{
        @Override
        public void play(String audioType){
            AdvancedPlayer player = null;
            if(audioType.equalsIgnoreCase("VcPlayer")){
                player = new VcPlayer();
                player.playVc();
            }else{
                player = new MediaPlayer();
                player.playMedia();
            }

        }
    }

    public static void main(String[] args){
        PlayerAdapter adapter = new AdapterPattern().new PlayerAdapter();
        adapter.play("VcPlayer");
    }
}
```

## 观察者模式

```java
public class ObserverPattern {

    class Subject{
        List<Observer> observers = new ArrayList<>();
        int state;

        public void setState(int state) {
            this.state = state;
            notifyAllObservers();
        }

        public int getState() {
            return state;
        }

        private void notifyAllObservers(){
            for(Observer o : observers){
                o.update();
            }
        }

        public void attach(Observer observer){
            this.observers.add(observer);
        }
    }

    abstract class Observer{
        protected Subject subject;
        abstract void update();
    }

    class ObserverA extends Observer{

        public ObserverA(Subject subject){
            this.subject = subject;
            subject.attach(this);
        }

        @Override
        public void update(){
            System.out.println("observer A: " + subject.getState());
        }
    }

    class ObserverB extends Observer{

        public ObserverB(Subject subject){
            this.subject = subject;
            subject.attach(this);
        }

        @Override
        public void update(){
            System.out.println("observer B: " + subject.getState());
        }
    }

    public static void main(String[] args){
        Subject subject = new ObserverPattern().new Subject();

        new ObserverPattern().new ObserverA(subject);
        new ObserverPattern().new ObserverB(subject);

        subject.setState(1);
    }
}

```
